document.addEventListener('DOMContentLoaded',()=>{const encryption=str=>window.btoa(unescape(encodeURIComponent(str)));const decrypt=str=>decodeURIComponent(escape(window.atob(str)));const cid=$('.joe_detail').attr('data-cid');{Prism.highlightAll();$("pre[class*='language-']").each(function(index,item){let text=$(item).find("code[class*='language-']").text();let span=$(`<span class="copy"><i class="fa fa-clone"></i></span>`);new ClipboardJS(span[0],{text:()=>text}).on('success',()=>Qmsg.success('复制成功！'));$(item).append(span)})}{$('.joe_detail__article img:not(img.owo_image)').each(function(){$(this).wrap($(`<span style="display: block;"data-fancybox="Joe"href="${$(this).attr('src')}"></span>`))})}{$('.joe_detail__article a:not(.joe_detail__article-anote)').each(function(){$(this).attr({target:'_blank',rel:'noopener noreferrer nofollow'})})}{let viewsArr=localStorage.getItem(encryption('views'))?JSON.parse(decrypt(localStorage.getItem(encryption('views')))):[];const flag=viewsArr.includes(cid);if(!flag){$.ajax({url:Joe.BASE_API,type:'POST',dataType:'json',data:{routeType:'handle_views',cid},success(res){if(res.code!==1)return;$('#Joe_Article_Views').html(`${res.data.views}阅读`);viewsArr.push(cid);const name=encryption('views');const val=encryption(JSON.stringify(viewsArr));localStorage.setItem(name,val)}})}}{let agreeArr=localStorage.getItem(encryption('agree'))?JSON.parse(decrypt(localStorage.getItem(encryption('agree')))):[];if(agreeArr.includes(cid))$('.joe_detail__agree .icon-1').addClass('active');else $('.joe_detail__agree .icon-2').addClass('active');let _loading=false;$('.joe_detail__agree .icon').on('click',function(){if(_loading)return;_loading=true;agreeArr=localStorage.getItem(encryption('agree'))?JSON.parse(decrypt(localStorage.getItem(encryption('agree')))):[];let flag=agreeArr.includes(cid);$.ajax({url:Joe.BASE_API,type:'POST',dataType:'json',data:{routeType:'handle_agree',cid,type:flag?'disagree':'agree'},success(res){if(res.code!==1)return;$('.joe_detail__agree .text').html(res.data.agree);if(flag){const index=agreeArr.findIndex(_=>_===cid);agreeArr.splice(index,1);$('.joe_detail__agree .icon-1').removeClass('active');$('.joe_detail__agree .icon-2').addClass('active');$('.joe_detail__agree .icon').removeClass('active')}else{agreeArr.push(cid);$('.joe_detail__agree .icon-2').removeClass('active');$('.joe_detail__agree .icon-1').addClass('active');$('.joe_detail__agree .icon').addClass('active')}const name=encryption('agree');const val=encryption(JSON.stringify(agreeArr));localStorage.setItem(name,val)},complete(){_loading=false}})})}{let isSubmit=false;$('.joe_detail__article-protected').on('submit',function(e){e.preventDefault();const url=$(this).attr('action')+'&time='+ +new Date();const protectPassword=$(this).find('input[type="password"]').val();if(protectPassword.trim()==='')return Qmsg.info('请输入访问密码！');if(isSubmit)return;isSubmit=true;$.ajax({url,type:'POST',data:{cid,protectCID:cid,protectPassword},dataType:'text',success(res){let arr=[],str='';arr=$(res).contents();Array.from(arr).forEach(_=>{if(_.parentNode.className==='container')str=_});if(!/Joe/.test(res)){Qmsg.warning(str.textContent.trim()||'');isSubmit=false;$('.joe_comment__respond-form .foot .submit button').html('发表评论')}else{location.reload()}}})})}{if($('.joe_detail__article-video').length>0){const player=$('.joe_detail__article-video .play iframe').attr('data-player');$('.joe_detail__article-video .episodes .item').on('click',function(){$(this).addClass('active').siblings().removeClass('active');const url=$(this).attr('data-src');$('.joe_detail__article-video .play iframe').attr({src:player+url})});$('.joe_detail__article-video .episodes .item').first().click()}}{if($('.joe_detail__operate-share').length){$('.joe_detail__operate-share > svg').on('click',e=>{e.stopPropagation();$('.joe_detail__operate-share').toggleClass('active')});$(document).on('click',()=>$('.joe_detail__operate-share').removeClass('active'))}}});window.addEventListener('load',function(){{const scroll=new URLSearchParams(location.search).get('scroll');if(scroll){const height=$('.joe_header').height();let elementEL=null;if($('#'+scroll).length>0){elementEL=$('#'+scroll)}else{elementEL=$('.'+scroll)}if(elementEL&&elementEL.length>0){const top=elementEL.offset().top-height-15;window.scrollTo({top,behavior:'smooth'})}}}});